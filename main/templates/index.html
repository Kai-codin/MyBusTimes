{% extends 'mbtbase.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/narrow.css' %}">
<style>
  .page {
    width: 100%;
  }

  @media (min-width: 48em) {
    .chips {
      grid-template-columns: none;
    }

    .panes {
      justify-content: space-between;
      margin: -1em 0;
      display: flex;
    }

    .pane {
      width: calc(50% - 10px);
    }

.discord-widget {
  width: 300px;
  max-height: 400px;
  margin: 20px auto;
  padding: 10px;
  background: #243447;
  border-radius: 10px;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
  overflow-y: auto;
}

.discord-widget h2 {
  text-align: center;
  margin-bottom: 12px;
  font-size: 1.2em;
  color: #aad4ff;
}

.member-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.member {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #2f4a5a;
  padding: 6px 8px;
  border-radius: 6px;
}

.member img {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 1px solid #aad4ff;
}

.member span {
  font-size: 0.85em;
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

  }
</style>
{% endblock %}

{% block title %}Home{% endblock %}

{% block content %}

<h2>Message of The Day</h2>
<p>{{ message }}</p>
<h2>Search</h2>
<p>Search for operators or routes</p>
<div class="homeSearch">
  <form action="search">
    <input type="search" name="q" id="q" placeholder="Search">
    <input type="submit" value="Search">
  </form>
</div>
<div class="status" style="display: none;">
    <div id="content" class="grid" aria-live="polite"></div>
</div>
<script src="{% static 'js/status-home.js' %}"></script>
<br>
<div class="ad-box" id="body-ad-1"></div>
<div class="panes">
  <div class="pane">
    <div class="helpful-links">
      <h2>Quick Links</h2>
      <ul class="chips">
        <li class="chip">
          {% if request.user.is_authenticated %}
          <a id="profile" href="/u/{{ request.user.username }}">My Profile</a>
          {% else %}
          <a id="profile" href="/account/login">Login</a>
          {% endif %}
        </li>
        {% if admin %}
        <li class="chip"><a href="/admin/">Admin Portal</a></li>
        {% endif %}
        <li class="chip"><a href="/operator/create/">Create A Company</a></li>
        <li class="chip"><a href="/create/livery">Create A Livery</a></li>
        <li class="chip"><a href="/create/vehicle">Request Vehicle Type</a></li>
        <!--<li class="chip"><a href="https://ticketer.mybustimes.cc">Ticketer (Alpha Demo)</a></li>-->
        <li class="chip for-sale-chip">
          <a href="/for_sale/">For Sale Vehicles</a>
          {% if for_sale_vehicles > 0 %}
          <span class="dot-badge">{% if for_sale_vehicles > 999 %}1k+{% else %}{{ for_sale_vehicles }}{% endif %}</span>
          {% endif %}
        </li>
        <li class="chip"><a href="/displays/">Bus Displays</a></li>
      </ul>
    </div>
  </div>
  <div class="pane">
    <h2>&nbsp;</h2>
    <ul class="chips">
     {% if user.is_superuser %}
        <li class="chip"><a href="/api-admin/">Admin API Portal</a></li>
        {% endif %}
      <li class="chip"><a href="/forum/">Forums</a></li>
      <li class="chip"><a href="/wiki/">Wiki</a></li>
      <li class="chip"><a href="/message/">Messages</a></li>
      <li class="chip"><a href="/tickets/">Open a Ticket</a></li>
      <li class="chip"><a href="/report">Bug Report</a></li>
      <li class="chip"><a href="/hub/">Community Hub</a></li>
    </ul>

  </div>
</div>
<br>
<p>
  Note: MyBusTimes is a fictional and community-run transport database.<br>
  All data shown here is user generated and not real world data <a href="/about">more info</a>.
</p>
<div class="ad-box" id="body-ad-2"></div>
<div id="regions-container">
  {% regroup regions by region_country as country_list %}

  {% for country in country_list %}
  <div>
    <h2>{{ country.grouper }}</h2>
    <ul>
      {% for region in country.list %}
      <li><a href="/region/{{ region.region_code }}">{{ region.region_name }}</a></li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}
</div>
<br>
<br>
 <h2>Join the Discord Community</h2>
<div id="discord-members"></div>

  <div id="discord-members" class="discord-widget">
    <h2>Online Members</h2>
    <div class="member-list"></div>
  </div>

  <script>
    fetch('https://discord.com/api/guilds/1276177154341867602/widget.json')
      .then(response => response.json())
      .then(data => {
        const members = data.members;
        const container = document.querySelector('.member-list');

        members.forEach(member => {
          const div = document.createElement('div');
          div.className = 'member';
          div.innerHTML = `
            <img src="${member.avatar_url}" alt="${member.username}">
            <span>${member.username}</span>
          `;
          container.appendChild(div);
        });
      })
      .catch(error => {
        console.error('Error fetching Discord members:', error);
      });
  </script>

{% endblock %}