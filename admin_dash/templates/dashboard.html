{% extends 'adminbase.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between mt-3">
    <div class="card flex-fill mb-2 mb-md-0 custom-card">
        <div class="card-body">
            <h5 class="card-title">Total Users</h5>
            <p class="card-text">Total Users: {{ user_count }}</p>
        </div>
    </div>
    <div class="card flex-fill mb-2 mb-md-0 custom-card">
        <div class="card-body">
            <h5 class="card-title">Active Users (Last 15 minutes)</h5>
            <p class="card-text">Active Users: {{ active_user_count }}</p>
        </div>
    </div>
</div>

<div class="d-flex flex-column flex-md-row justify-content-between mt-3">
    <div class="card flex-fill mb-2 mb-md-0 full-width-card">
        <div class="card-body">
            <h5 class="card-title">User Joins per day</h5>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <form method="get" id="periodForm">
                <select name="period" onchange="document.getElementById('periodForm').submit()">
                    <option value="all" {% if current_period == 'all' %}selected{% endif %}>All Time</option>
                    <option value="this_week" {% if current_period == 'this_week' %}selected{% endif %}>This Week
                    </option>
                    <option value="last_week" {% if current_period == 'last_week' %}selected{% endif %}>Last Week
                    </option>
                    <option value="this_month" {% if current_period == 'this_month' %}selected{% endif %}>This Month
                    </option>
                    <option value="last_month" {% if current_period == 'last_month' %}selected{% endif %}>Last Month
                    </option>
                    <option value="this_year" {% if current_period == 'this_year' %}selected{% endif %}>This Year
                    </option>
                    <option value="last_year" {% if current_period == 'last_year' %}selected{% endif %}>Last Year
                    </option>
                </select>
            </form>

            <canvas id="userJoinChart" width="600" height="300"></canvas>

            <script>
                const userJoinData = {{ user_joins_per_day | safe }};

                const labels = userJoinData.map(entry => entry.day);
                const counts = userJoinData.map(entry => entry.count);

                const ctx = document.getElementById("userJoinChart").getContext("2d");
                new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: labels,
                        datasets: [{
                            label: "Users Joined",
                            data: counts,
                            borderColor: "blue",
                            backgroundColor: "rgba(0, 0, 255, 0.2)",
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: "Date"
                                }
                            },
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "Users Joined"
                                }
                            }
                        }
                    }
                });
            </script>
        </div>
    </div>
</div>

{% endblock %}