{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Stop Names{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/narrow.css' %}">
    <style>
        .inline-stop-name {
        display: flex;
        }

        .inline-stop-name button {
        height: 30px;
        margin-top: 4px;
        margin-left: 5px;
        }

        .inline-stop-name input {
        max-width: calc(100% - 30px) !important;
        min-width: calc(100% - 30px) !important;
        margin-bottom: -50px;
        }
    </style>
{% endblock %}

{% block content %}
    <h2>Edit Stop Names for Route: {{ routeData.route_num }}</h2>

    <form method="POST" class="fleet-edit-wrapper">
        {% csrf_token %}
        <div id="stop-names-container">
            {% for stop in prefilled_stops %}
            <span class="inline-stop-name">
                <input type="text" name="stop_names" value="{{ stop }}" required>
                <button type="button" class="remove-stop-name">X</button>
            </span>
            {% endfor %}
            {% if prefilled_stops|length == 0 %}
            <span>
                <input type="text" name="stop_names" placeholder="Enter stop name" required>
                <button type="button" class="remove-stop-name">X</button>
            </span>
            {% endif %}
        </div>
        <br>
        <button type="button" id="add-stop-name">Add Another Stop Name</button>
        <button type="submit">Update Stops</button>
    </form>

    <script>
        // Function to create a new stop name input with remove button
        function createStopNameField(value = '') {
            const span = document.createElement('span');
            span.className = 'inline-stop-name';

            const input = document.createElement('input');
            input.type = 'text';
            input.name = 'stop_names';
            input.placeholder = 'Enter stop name';
            input.required = true;
            input.value = value;

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.className = 'remove-stop-name';
            removeButton.textContent = 'X';
            removeButton.addEventListener('click', function() {
                span.remove();
            });

            span.appendChild(input);
            span.appendChild(removeButton);

            return span;
        }

        // Add new stop name on button click
        document.getElementById('add-stop-name').addEventListener('click', function () {
            const container = document.getElementById('stop-names-container');
            container.appendChild(createStopNameField());
        });

        // Enable remove functionality for already rendered remove buttons
        document.querySelectorAll('.remove-stop-name').forEach(function(button) {
            button.addEventListener('click', function () {
                this.parentElement.remove();
            });
        });
    </script>
{% endblock %}
